Script started on 2020-03-06 15:29:55+0300
]0;vasya@Moisey-NB: ~/mylinux/1-3-finl[01;32mvasya@Moisey-NB[00m:[01;34m~/mylinux/1-3-finl[00m$ vagrant up
[0mBringing machine 'lvm' up with 'virtualbox' provider...[0m
[1m==> lvm: Importing base box 'centos/7'...[0m
[0m[K[0m[0mProgress: 20%[0m[0m[K[0m[0mProgress: 40%[0m[0m[K[0m[0mProgress: 70%[0m[0m[K[0m[0mProgress: 90%[0m[0m[K[0m[1m==> lvm: Matching MAC address for NAT networking...[0m
[1m==> lvm: Checking if box 'centos/7' version '1804.02' is up to date...[0m
[1m==> lvm: Setting the name of the VM: 1-3-finl_lvm_1583497816309_61643[0m
[1m==> lvm: Clearing any previously set network interfaces...[0m
[1m==> lvm: Preparing network interfaces based on configuration...[0m
[0m    lvm: Adapter 1: nat[0m
[0m    lvm: Adapter 2: hostonly[0m
[1m==> lvm: Forwarding ports...[0m
[0m    lvm: 22 (guest) => 2222 (host) (adapter 1)[0m
[1m==> lvm: Running 'pre-boot' VM customizations...[0m
[1m==> lvm: Booting VM...[0m
[1m==> lvm: Waiting for machine to boot. This may take a few minutes...[0m
[0m    lvm: SSH address: 127.0.0.1:2222[0m
[0m    lvm: SSH username: vagrant[0m
[0m    lvm: SSH auth method: private key[0m
[0m    lvm: Warning: Connection reset. Retrying...[0m
[0m    lvm: Warning: Remote connection disconnect. Retrying...[0m
[0m    lvm: Warning: Remote connection disconnect. Retrying...[0m
[0m    lvm: Warning: Remote connection disconnect. Retrying...[0m
[0m    lvm: 
    lvm: Vagrant insecure key detected. Vagrant will automatically replace
    lvm: this with a newly generated keypair for better security.[0m
[0m    lvm: 
    lvm: Inserting generated public key within guest...[0m
[0m    lvm: Removing insecure key from the guest if it's present...[0m
[0m    lvm: Key inserted! Disconnecting and reconnecting using new SSH key...[0m
[1m==> lvm: Machine booted and ready![0m
[1m==> lvm: Checking for guest additions in VM...[0m
[0m    lvm: No guest additions were detected on the base box for this VM! Guest
    lvm: additions are required for forwarded ports, shared folders, host only
    lvm: networking, and more. If SSH fails on this machine, please install
    lvm: the guest additions and repackage the box to continue.
    lvm: 
    lvm: This is not an error message; everything may continue to work properly,
    lvm: in which case you may ignore this message.[0m
[1m==> lvm: Setting hostname...[0m
[1m==> lvm: Configuring and enabling network interfaces...[0m
[1m==> lvm: Rsyncing folder: /home/vasya/mylinux/1-3-finl/ => /vagrant[0m
[1m==> lvm: Running provisioner: shell...[0m
[0m    lvm: Running: inline script[0m
[0;32m    lvm: Loaded plugins: fastestmirror[0m
[0;32m    lvm: Determining fastest mirrors[0m
[0;32m    lvm:  * base: mirror.docker.ru
    lvm:  * extras: dedic.sh
    lvm:  * updates: mirror.docker.ru[0m
[0;32m    lvm: Resolving Dependencies
    lvm: --> Running transaction check
    lvm: ---> Package gdisk.x86_64 0:0.8.10-3.el7 will be installed[0m
[0;32m    lvm: ---> Package hdparm.x86_64 0:9.43-5.el7 will be installed
    lvm: ---> Package mdadm.x86_64 0:4.1-1.el7 will be installed[0m
[0;32m    lvm: --> Processing Dependency: libreport-filesystem for package: mdadm-4.1-1.el7.x86_64[0m
[0;32m    lvm: ---> Package smartmontools.x86_64 1:7.0-1.el7_7.1 will be installed[0m
[0;32m    lvm: --> Processing Dependency: mailx for package: 1:smartmontools-7.0-1.el7_7.1.x86_64
    lvm: --> Running transaction check
    lvm: ---> Package libreport-filesystem.x86_64 0:2.1.11-43.el7.centos will be installed
    lvm: ---> Package mailx.x86_64 0:12.5-19.el7 will be installed[0m
[0;32m    lvm: --> Finished Dependency Resolution[0m
[0;32m    lvm: 
    lvm: Dependencies Resolved[0m
[0;32m    lvm: 
    lvm: ================================================================================
    lvm:  Package                  Arch       Version                  Repository   Size
    lvm: ================================================================================
    lvm: Installing:
    lvm:  gdisk                    x86_64     0.8.10-3.el7             base        190 k
    lvm:  hdparm                   x86_64     9.43-5.el7               base         83 k
    lvm:  mdadm                    x86_64     4.1-1.el7                base        435 k
    lvm:  smartmontools            x86_64     1:7.0-1.el7_7.1          updates     546 k
    lvm: Installing for dependencies:
    lvm:  libreport-filesystem     x86_64     2.1.11-43.el7.centos     base         40 k
    lvm:  mailx                    x86_64     12.5-19.el7              base        245 k
    lvm: 
    lvm: Transaction Summary
    lvm: ================================================================================
    lvm: Install  4 Packages (+2 Dependent packages)[0m
[0;32m    lvm: Total download size: 1.5 M[0m
[0;32m    lvm: Installed size: 4.2 M[0m
[0;32m    lvm: Downloading packages:[0m
[0;31m    lvm: warning: /var/cache/yum/x86_64/7/base/packages/libreport-filesystem-2.1.11-43.el7.centos.x86_64.rpm: Header V3 RSA/SHA256 Signature, key ID f4a80eb5: NOKEY[0m
[0;32m    lvm: Public key for libreport-filesystem-2.1.11-43.el7.centos.x86_64.rpm is not installed[0m
[0;32m    lvm: Public key for smartmontools-7.0-1.el7_7.1.x86_64.rpm is not installed[0m
[0;32m    lvm: --------------------------------------------------------------------------------[0m
[0;32m    lvm: Total                                              1.8 MB/s | 1.5 MB  00:00     [0m
[0;32m    lvm: Retrieving key from file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7[0m
[0;31m    lvm: Importing GPG key 0xF4A80EB5:
    lvm:  Userid     : "CentOS-7 Key (CentOS 7 Official Signing Key) <security@centos.org>"
    lvm:  Fingerprint: 6341 ab27 53d7 8a78 a7c2 7bb1 24c6 a8a7 f4a8 0eb5
    lvm:  Package    : centos-release-7-5.1804.el7.centos.x86_64 (@anaconda)
    lvm:  From       : /etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7[0m
[0;32m    lvm: Running transaction check[0m
[0;32m    lvm: Running transaction test[0m
[0;32m    lvm: Transaction test succeeded[0m
[0;32m    lvm: Running transaction[0m
[0;32m    lvm:   Installing : mailx-12.5-19.el7.x86_64                                     1/6[0m
[0;32m    lvm:  
    lvm:   Installing : libreport-filesystem-2.1.11-43.el7.centos.x86_64             2/6[0m
[0;32m    lvm:  
    lvm:   Installing : mdadm-4.1-1.el7.x86_64                                       3/6[0m
[0;32m    lvm:  
    lvm:   Installing : 1:smartmontools-7.0-1.el7_7.1.x86_64                         4/6[0m
[0;32m    lvm:  
    lvm:   Installing : hdparm-9.43-5.el7.x86_64                                     5/6[0m
[0;32m    lvm:  
    lvm:   Installing : gdisk-0.8.10-3.el7.x86_64                                    6/6[0m
[0;32m    lvm:  
    lvm:   Verifying  : libreport-filesystem-2.1.11-43.el7.centos.x86_64             1/6[0m
[0;32m    lvm:  
    lvm:   Verifying  : mdadm-4.1-1.el7.x86_64                                       2/6[0m
[0;32m    lvm:  
    lvm:   Verifying  : gdisk-0.8.10-3.el7.x86_64                                    3/6[0m
[0;32m    lvm:  
    lvm:   Verifying  : mailx-12.5-19.el7.x86_64                                     4/6[0m
[0;32m    lvm:  
    lvm:   Verifying  : 1:smartmontools-7.0-1.el7_7.1.x86_64                         5/6[0m
[0;32m    lvm:  
    lvm:   Verifying  : hdparm-9.43-5.el7.x86_64                                     6/6[0m
[0;32m    lvm:  
    lvm: 
    lvm: Installed:
    lvm:   gdisk.x86_64 0:0.8.10-3.el7        hdparm.x86_64 0:9.43-5.el7                 
    lvm:   mdadm.x86_64 0:4.1-1.el7           smartmontools.x86_64 1:7.0-1.el7_7.1       
    lvm: 
    lvm: Dependency Installed:
    lvm:   libreport-filesystem.x86_64 0:2.1.11-43.el7.centos mailx.x86_64 0:12.5-19.el7[0m
[0;32m    lvm: Complete![0m
]0;vasya@Moisey-NB: ~/mylinux/1-3-finl[01;32mvasya@Moisey-NB[00m:[01;34m~/mylinux/1-3-finl[00m$ vagrant ssh
]0;vagrant@lvm:~[?1034h[vagrant@lvm ~]$ lsblk
NAME                    MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda                       8:0    0   40G  0 disk 
â”œâ”€sda1                    8:1    0    1M  0 part 
â”œâ”€sda2                    8:2    0    1G  0 part /boot
â””â”€sda3                    8:3    0   39G  0 part 
  â”œâ”€VolGroup00-LogVol00 253:0    0 37.5G  0 lvm  /
  â””â”€VolGroup00-LogVol01 253:1    0  1.5G  0 lvm  [SWAP]
sdb                       8:16   0   10G  0 disk 
sdc                       8:32   0    2G  0 disk 
sdd                       8:48   0    1G  0 disk 
sde                       8:64   0    1G  0 disk 
]0;vagrant@lvm:~[vagrant@lvm ~]$ sudo -i
]0;root@lvm:~[?1034h[root@lvm ~]# mkfs.btrfs -m raid1 -d raid0 /dev/sdb /dev/sdc
btrfs-progs v4.9.1
See http://btrfs.wiki.kernel.org for more information.

Label:              (null)
UUID:               a7de2185-f2d3-4d15-bf5b-fa9d22dceece
Node size:          16384
Sector size:        4096
Filesystem size:    12.00GiB
Block group profiles:
  Data:             RAID0             1.20GiB
  Metadata:         RAID1             1.00GiB
  System:           RAID1             8.00MiB
SSD detected:       no
Incompat features:  extref, skinny-metadata
Number of devices:  2
Devices:
   ID        SIZE  PATH
    1    10.00GiB  /dev/sdb
    2     2.00GiB  /dev/sdc

]0;root@lvm:~[root@lvm ~]# mkdir /mnt/btrfs
]0;root@lvm:~[root@lvm ~]# mount /dev/sdb /mnt/btrfs
]0;root@lvm:~[root@lvm ~]# df -h
Filesystem                       Size  Used Avail Use% Mounted on
/dev/mapper/VolGroup00-LogVol00   38G  760M   37G   2% /
devtmpfs                         1.9G     0  1.9G   0% /dev
tmpfs                            1.9G     0  1.9G   0% /dev/shm
tmpfs                            1.9G  8.5M  1.9G   1% /run
tmpfs                            1.9G     0  1.9G   0% /sys/fs/cgroup
/dev/sda2                       1014M   63M  952M   7% /boot
tmpfs                            380M     0  380M   0% /run/user/1000
/dev/sdb                          12G   17M  2.0G   1% /mnt/btrfs
]0;root@lvm:~[root@lvm ~]# btrfs subvolume create /mnt/btrfs/sv-opt
Create subvolume '/mnt/btrfs/sv-opt'
]0;root@lvm:~[root@lvm ~]# ll /mnt/btrfs/
total 0
drwxr-xr-x. 1 root root 0 Mar  6 12:32 [0m[38;5;27msv-opt[0m
]0;root@lvm:~[root@lvm ~]# btrfs subvolume list /mnt/btrfs
ID 258 gen 7 top level 5 path sv-opt
]0;root@lvm:~[root@lvm ~]# mount -o subvolid=261 /dev/sdb /opt
mount: mount(2) failed: No such file or directory
]0;root@lvm:~[root@lvm ~]# mount -o subvolid=261 /dev/sdb /opt[1P[1P[1@5[1@8
]0;root@lvm:~[root@lvm ~]# cd /opt
]0;root@lvm:/opt[root@lvm opt]# touch file{1..10}
]0;root@lvm:/opt[root@lvm opt]# ll
total 0
-rw-r--r--. 1 root root 0 Mar  6 12:33 file1
-rw-r--r--. 1 root root 0 Mar  6 12:33 file10
-rw-r--r--. 1 root root 0 Mar  6 12:33 file2
-rw-r--r--. 1 root root 0 Mar  6 12:33 file3
-rw-r--r--. 1 root root 0 Mar  6 12:33 file4
-rw-r--r--. 1 root root 0 Mar  6 12:33 file5
-rw-r--r--. 1 root root 0 Mar  6 12:33 file6
-rw-r--r--. 1 root root 0 Mar  6 12:33 file7
-rw-r--r--. 1 root root 0 Mar  6 12:33 file8
-rw-r--r--. 1 root root 0 Mar  6 12:33 file9
]0;root@lvm:/opt[root@lvm opt]# btrfs subvolume snapshot /mnt/btrfs/sv-opt/ /mnt/btrfs/sv-backup/
Create a snapshot of '/mnt/btrfs/sv-opt/' in '/mnt/btrfs/sv-backup'
]0;root@lvm:/opt[root@lvm opt]# ll /mnt/btrfs/sv-backup/
total 0
-rw-r--r--. 1 root root 0 Mar  6 12:33 file1
-rw-r--r--. 1 root root 0 Mar  6 12:33 file10
-rw-r--r--. 1 root root 0 Mar  6 12:33 file2
-rw-r--r--. 1 root root 0 Mar  6 12:33 file3
-rw-r--r--. 1 root root 0 Mar  6 12:33 file4
-rw-r--r--. 1 root root 0 Mar  6 12:33 file5
-rw-r--r--. 1 root root 0 Mar  6 12:33 file6
-rw-r--r--. 1 root root 0 Mar  6 12:33 file7
-rw-r--r--. 1 root root 0 Mar  6 12:33 file8
-rw-r--r--. 1 root root 0 Mar  6 12:33 file9
]0;root@lvm:/opt[root@lvm opt]# rm -rf /opt/file{1..5} && ll
total 0
-rw-r--r--. 1 root root 0 Mar  6 12:33 file10
-rw-r--r--. 1 root root 0 Mar  6 12:33 file6
-rw-r--r--. 1 root root 0 Mar  6 12:33 file7
-rw-r--r--. 1 root root 0 Mar  6 12:33 file8
-rw-r--r--. 1 root root 0 Mar  6 12:33 file9
]0;root@lvm:/opt[root@lvm opt]# cd ..
]0;root@lvm:/[root@lvm /]# umount /opt
]0;root@lvm:/[root@lvm /]# btrfs subvolume list /mnt/btrfs
ID 258 gen 9 top level 5 path sv-opt
ID 259 gen 9 top level 5 path sv-backup
]0;root@lvm:/[root@lvm /]# mount -o subvolid=263 /dev/sdb /opt[1P[1P[1@5[1@9
]0;root@lvm:/[root@lvm /]# ll /opt
total 0
-rw-r--r--. 1 root root 0 Mar  6 12:33 file1
-rw-r--r--. 1 root root 0 Mar  6 12:33 file10
-rw-r--r--. 1 root root 0 Mar  6 12:33 file2
-rw-r--r--. 1 root root 0 Mar  6 12:33 file3
-rw-r--r--. 1 root root 0 Mar  6 12:33 file4
-rw-r--r--. 1 root root 0 Mar  6 12:33 file5
-rw-r--r--. 1 root root 0 Mar  6 12:33 file6
-rw-r--r--. 1 root root 0 Mar  6 12:33 file7
-rw-r--r--. 1 root root 0 Mar  6 12:33 file8
-rw-r--r--. 1 root root 0 Mar  6 12:33 file9
]0;root@lvm:/[root@lvm /]# exit
logout
]0;vagrant@lvm:~[vagrant@lvm ~]$ exit
logout
Connection to 127.0.0.1 closed.
]0;vasya@Moisey-NB: ~/mylinux/1-3-finl[01;32mvasya@Moisey-NB[00m:[01;34m~/mylinux/1-3-finl[00m$ exit
exit

Script done on 2020-03-06 15:34:50+0300
